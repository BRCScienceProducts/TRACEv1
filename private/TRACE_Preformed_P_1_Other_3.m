function [Y,Xf,Af] = TRACE_Preformed_P_1_Other_3(X,~,~)
%TRACE_PREFORMED_P_1_OTHER_3 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:38.
% 
% [Y] = TRACE_Preformed_P_1_Other_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-77.5;0;30.1649227142334;-2.9811577796936];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0119760479041916;0.000363636363636364;0.22152510192902;0.0532708976942295];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.052103283284782087;7.0236695141628482375;8.1125466568846142934;5.9314121804884729627;0.41653914870066766074;0.46325260609016394309;-0.21038027344518281381;-13.056476770638635543;0.11354251508873917931;-0.033013276410907975433;-2.4410413182268899668;2.8458527189346516373;2.6592504934772680514;-1.097776372579122528;5.8588447786457180655];
IW1_1 = [0.20425651890018051149 -0.018627243813038790732 1.085037978880638132 -0.42584378756630086871 0.36475921967032864934 -0.18646138025677375105;-0.03885925102110070195 0.0012538397540922067291 1.611687252647919788 4.742600668922581697 -0.020929586720576893316 -0.57200909188949256023;0.0091485032115396387742 -0.0175449430445808012 2.0117349486974962502 -0.21309382804527127186 0.44881331985153571917 8.835801410011544732;0.10431328417996207913 -0.19965415855669929601 -0.33761413672060319735 5.5151010556480315472 1.7689840196471249278 -0.51816450888081200254;-0.17372624550720550118 -0.090825352617235219355 1.1842840233777354175 -0.61157444003025795976 -2.7338668578263716213 2.837693241024649371;-0.015089176693877645596 0.056092865935824860746 -0.18253225741770179313 -0.023204936095142070229 -5.9072641632580147331 0.50288190646061337041;0.50485438807421834095 -0.89523334845332702692 -1.3057367983296528369 -0.27550127164000676183 0.16874607928048274141 0.68815238574257375781;0.4978357415635591976 -1.3608180907568399043 2.2863570840931406458 -11.718705974243796675 7.9752634846969749916 -1.1135707859534660358;0.31034280555025850479 -1.5034287660369494155 -4.3775711591505777065 2.3811534265281011358 -1.1855198405511591098 0.048365592137531054906;-0.16042469966070097009 0.26554589118744553744 1.1953848735694427852 -0.065794050339054166443 -0.74155811440608165874 -0.52930642867919641681;0.029443122672558681013 -0.17031102061330072317 1.4870341889473703834 0.034753705891505407011 -2.8110641521316841462 -4.0941860281582185266;1.605618172773873864 -1.0539045190236493443 -4.2844379682028286283 0.45234384465426702437 0.73163981980103409697 -1.5183253551296032047;-0.32285201413612307775 0.28926204482786821437 -1.0879123944496731369 1.8911402012037166198 -4.8562710329676761489 1.2793066598476960927;-0.25324403419137297977 0.39629461695529188958 -2.2958209140653460523 -0.034227542532453948676 0.82893988366822690672 0.29020266092427932092;2.3478824056584302049 2.9119982528864669646 -0.83184070218757633075 2.4860577596886832552 -0.53324527156873124945 2.4405705638754384701];

% Layer 2
b2 = [2.0150622968726752404;2.5717501624622789436;-8.2050885316893946708;1.1987429987297590905;-10.917065675739673125];
LW2_1 = [1.7703017915307699415 -1.076782145969402249 0.54623554443938948655 -1.322083441573238316 -0.31380871722065378782 -0.10298004744910814467 0.049766684400337858618 0.58937764656477353853 0.16956407716653584816 -0.87519004104323205873 0.70956625775409243317 0.59637573745202188125 0.85501622371523722244 0.53836228736862501432 -0.096591816537057492709;1.865552336854562343 -1.6290947612330430871 0.47419716036167641748 -1.3641867881463227707 -0.27144107365291947342 -0.12203133468382547366 -0.075839337634952735945 0.57316098478196297883 0.17959069257062057479 -1.0928903634050621818 0.64990660401263611323 0.68820057838115478166 0.8622822169922428337 0.41514183463142589892 -0.096503134019018249612;-1.4324782231949937383 8.2117710137888888511 0.096433196740984078454 0.99884029221388503927 0.34357650561165359315 0.25816799244457078188 0.91316075267654295278 -0.68916677570857587387 -0.12870675911329135244 2.5969713837218941777 -0.069250407469642588643 -0.83971520260690368787 -1.2471608427940712449 0.67051427166997712437 0.09793557017596628278;1.1223111815646695799 -0.95142796685632013975 0.41938686803977376361 -1.0206246737242024025 0.38250353714966345287 -1.4769524659628883168 -0.79971867139332730723 0.10360972237693109876 -0.034371957269451948458 -2.2892337215716120902 -0.44621530371729095643 0.15873561983212899906 1.6687503583512184324 -0.50530349863001733368 -0.21472682512179400161;-3.637656222283069507 11.482800768598979246 -0.69495378732340074013 1.9289169392272385029 -0.19449019486824478675 0.24161732720531592378 1.4008545600339907811 -0.79083015398442313426 -0.29667268547278397017 2.2065658646229482365 -0.088999445737646357135 -1.9955118289405111565 -1.4428917972709940365 1.0181532316452648335 0.42621992358812116342];

% Layer 3
b3 = 0.13910242955229171202;
LW3_2 = [10.058815571451997783 -11.546137108967453599 -1.3075347804304333632 -0.5058514854747122591 -0.76294462253038974886];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.683263173544107;
y1_step1.xoffset = -0.138191044330597;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
