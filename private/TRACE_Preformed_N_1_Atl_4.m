function [Y,Xf,Af] = TRACE_Preformed_N_1_Atl_4(X,~,~)
%TRACE_PREFORMED_N_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:40.
% 
% [Y] = TRACE_Preformed_N_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.2838442571186579055;-1.1061026075327751172;-1.1593497077931986805;-1.9475201888755473423;9.1444894627232962137];
IW1_1 = [0.025753918575299572513 0.042243640112032139478 -0.79937417320123305142 -0.83818541598013363014 -0.27280909475717124435 -0.23858708617477134006;-0.049639882220595024642 -0.028197481286027423902 0.20135577292914785819 -0.91231114293663662096 -0.075473570761925720674 -1.5693802812865993435;-0.39225865624301919921 0.3946945893224583779 -0.46120987729663476262 -1.9479977532500438731 -0.33149975172823559211 -0.12108826284453287625;0.19499203983068547075 -0.075230750685012684476 -1.3355343185600720979 -0.1560472915952921813 -4.4432206984120226068 -0.29936651279841425266;0.16119961896040124749 -0.14984467550439323213 -0.049917359453044110595 9.0799756717009945106 0.13092087080741482419 -0.61799806321236916418];

% Layer 2
b2 = [-0.86791358756299341604;0.77813603652775820141;4.7513161127680003659;-0.53878755286528823287;-2.3697660357568635092;-5.6983281522973916466;-1.1711013275400348199;0.1895271147551334523;-4.2306369281306821506;-2.182603919155080785;-2.0516150434901825328;-7.7826878335630080841;-2.1840397911530922137;1.7066056312835000686;8.7415350470173063258];
LW2_1 = [-6.2053895859139069913 0.65288866616415086597 6.1122997236438632029 3.6791465133554961398 2.4921745437466671369;1.2612404027382977389 -1.1093956435672984728 0.14930421221398360032 -0.39406027264514009723 1.606925991225629069;-5.5645700954013870287 -3.1979879935125481438 -2.4269805682546956582 5.1637826385417930908 -3.0362871849278052494;-5.7792573776712998779 6.6828537424720195759 -4.4969939079131000526 4.6258852736077056278 -5.3638886900065836372;-3.1828726162207159334 0.52898738221975938334 1.5434114510389180808 0.71440637924712280249 2.0761824811392015633;-6.6575159551188134444 -3.6180750857626704509 4.7590114641143248519 -4.4899907480140637261 0.0030751065776569220557;-10.333505437360514634 2.8130891847790975291 3.3083232529464452476 1.9869654642345080386 -2.2585104079503484087;-5.3151717351013605395 3.4561548866205371588 3.9588429001797464934 0.056823509428401516863 1.6876002723030960606;0.67867182942854809014 2.3172677102978713748 2.1973105463116877623 -0.99256717400021765574 2.9837150497730782206;-1.8762465438527133887 -0.2048659001712425376 0.73121215171016673562 0.073562644403358190548 1.1979551018559253528;1.2427231077110605373 -2.152246972480808207 -2.0047158191779694825 1.2034567233705164568 0.86973776467548313818;-3.5064153766414825064 -0.56766707736006261076 4.5238355881675555992 1.1784459327606939816 11.772826532443643188;-2.2631579130315668813 0.30532035435994070438 1.1165082056785118336 0.42340724660094425369 0.6558310776391389485;1.7662990225851993298 -0.35565341111604820146 -1.144341140348437591 -0.37302224354100643744 -0.62160194290223647062;0.42097746160530508108 9.5748594991498343632 2.3087508458325172178 -0.93399290841262894158 1.1175927746645162308];

% Layer 3
b3 = -0.94292528153779775479;
LW3_2 = [0.12415387887872063322 2.1598704210086627775 0.11504748714827320311 -0.11274459583093064674 2.1496639822664325159 0.098512139408034826715 -0.13930637736271836435 0.80372325876394412614 0.44366458784982365504 -3.6635403115391960149 1.0660700954828870035 -0.084578395272534481752 10.580801044301413327 9.7761359730074328667 -0.6767359680677402789];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0686941773550495;
y1_step1.xoffset = -0.494993358850479;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
