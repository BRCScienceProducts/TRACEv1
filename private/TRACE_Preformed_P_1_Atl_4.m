function [Y,Xf,Af] = TRACE_Preformed_P_1_Atl_4(X,~,~)
%TRACE_PREFORMED_P_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:38.
% 
% [Y] = TRACE_Preformed_P_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.193113412404622764;1.1716887454758175835;-0.19945625371070194176;1.5338502033944549918;3.3735387132314005321];
IW1_1 = [1.0794107759103068744 0.19834738353149042323 -0.78139618487021111903 1.438725626087963505 -2.2380565193408363811 0.9218926202180731666;0.72560339973296617 -0.064850033268176204837 1.6587554058610627372 0.28749518821391267798 1.6563864845156286432 0.4695652514559609525;0.055276299189187402816 -0.31199969094014018411 0.99312351863570980104 -0.0086104982789962578038 -0.27026543977458344914 -2.1111653430670935805;-0.098584126085998369238 -0.046158065886713804671 0.6947022693199838006 2.8138012242643202221 0.96419381526315073305 -0.48860590048308033539;-0.004762177792312772065 0.021758178989898711159 -1.4431770113056980875 2.1783165832309752119 0.11385291220900348175 0.99116324272418832031];

% Layer 2
b2 = [-1.2261496074554691926;-0.35272435293943021906;-5.6314318975137940271;0.48386494900418008935;-3.6012282114262887944;0.71792553070697084916;-3.5720533611524194484;6.9349425659562804469;-1.1429506168938707855;1.2302850392953228464;2.0206833670120256663;-2.5621651726588070552;-4.0964734373178970372;-3.7602127594348289108;-0.36213172277154331846];
LW2_1 = [-1.4060776818631517404 0.71465244076711109678 -0.56909707196194214696 0.26262872020847555232 0.17110145473303464692;-1.3195837171806719113 -0.27403524125934192179 0.027562326204821876313 -0.26386894767969248932 0.091565766339907081472;4.075532724517557881 0.78799857654608151947 1.0834577392749706881 -2.1565958070667430313 7.535151504432142211;-2.1570231612058079484 -0.79319152615389010297 3.5585531966252208491 2.638581412206621124 5.4163666846550571066;-5.3197815186005215082 -2.0276541053177874474 -2.6839551745868566179 3.0708541673595002308 -2.6006947277548735364;4.3681928811972907667 -0.79088764718437232215 0.61085440395174417372 -3.891125562720631148 -0.46004863309505844571;-2.4632769955522939576 1.801783479439743374 1.3549699120065337166 -2.1192626162427643521 2.3370496978774260022;1.2998899719366869832 -1.0857410728982777037 -1.0673095836635841938 2.0745877089875608412 3.7141779334940787649;5.267149638447541804 2.3414217957698815198 -1.0466090643294498896 -7.9621165439675580799 -2.1405900146723171318;-1.7235775077628663343 0.48196631920897992085 0.3923048079965494872 3.7489647740567613177 0.37519967843356338832;1.8693161597919727424 2.4585510483596904052 -4.0795164442295375196 2.1098333572699101701 -2.3203444571353180059;-1.167595166558546449 2.2373789055325357111 -3.2720497295233474944 1.3010324905283197072 -0.8551835108962150267;0.8684608066435004492 0.78065448121577374341 0.034752620413301300861 -2.1950036047600485212 -4.1058605643702277277;-1.5855741908176264054 -4.9365120795612433824 2.2876009162480013259 -0.35453546805537816677 7.7484464401790598131;-0.71675504150218782851 -0.51826575684830589186 0.16202133403414936685 -0.28960296251060885231 -0.087398223618109907584];

% Layer 3
b3 = -2.7175107460628193934;
LW3_2 = [-4.8710077399396114473 8.2218741653855804685 0.6044366920067455462 7.6666468454417140421 0.40406505824127758597 -2.0082169432203151871 0.57322891137920695126 5.6337659746225856594 -0.27922037929350712604 -1.5659182697209268476 0.42455739500164707545 -0.67313737697042608232 14.747006567838280233 -0.059833580967651962823 -7.5942784914665439899];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.965459001831992;
y1_step1.xoffset = -0.121618166565895;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
