function [Y,Xf,Af] = TRACE_Preformed_N_1_Atl_3(X,~,~)
%TRACE_PREFORMED_N_1_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:40.
% 
% [Y] = TRACE_Preformed_N_1_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.53213369099084883995;1.6243983553010079568;1.9397554661939244713;-1.7061090115441126525;-0.72325747242475446619;-0.8052039469735076116;-0.88836383091312187688;31.463338989896882936;-9.3652172745786828045;0.051045907823856748187;-0.74254178966843586984;-2.8613520566872421291;1.2233885064166636347;4.2061826075289623361;2.943759481487843388];
IW1_1 = [0.017203550884874331539 0.064564595901996021943 1.2021094478489684487 -1.0783770169713062792 1.0222457282499137765 0.56701954499143025767;0.079917353829070489346 -0.16588028765138754239 -1.3413065568089250768 -0.7427354281723770324 -0.010085411098386263401 0.76970612665036219902;-0.72751912598169454771 -1.0362602503285427424 -0.8045586385253042927 1.280866669553973658 0.97511010277511334099 1.065612145456785953;0.071509147702383396572 1.0671488195171496827 1.864399829214102855 2.162840677105321241 -1.525602380067643038 -2.6932521138112863746;0.45511409723515111603 -0.19891579666422187778 -0.96457572883480435788 -1.4907629409180316316 -0.63146292480769694588 0.5323008661034914768;0.02147453932352455519 -0.20581748748044592645 -1.4632538486046255954 -1.639101026428244845 0.15516449279058694422 1.6899262606397833508;-0.21024902049723331876 0.074344194458531576153 1.2767411991236294888 0.11407936319249521728 -3.46001907492537919 -1.4322878669405121332;0.80092394093759999851 -0.0080005121024438914656 -0.11351043920716728797 32.128913560841397157 -1.0136321867644053629 -1.1017944380739590482;1.4466817949864398951 -3.6120586988319947075 9.1148728310171982514 -6.98683170383558938 7.1818027529163694922 0.52635172836060384327;-0.41907101937659069213 0.095335122710668671053 1.3351466825840807573 1.0761399299442080402 -1.9282020817407419244 -1.481883295928154709;-1.2662076672323032689 -0.79512341318364987419 0.13427705029631178957 1.6000121387245349602 1.457442553336616653 -0.97672147870238668066;0.99110341467966811546 0.053478595112162304048 -2.9613894884148992404 -1.7966127793727157957 -1.4846063477337854142 -0.15835294886981632345;0.27705365343988086479 -0.051407804825375755242 -1.631341401227818233 0.0050742729427526635927 3.9280112245957146122 1.7284995804422946808;-1.9569369751623861831 2.3003541629358954523 4.7646024533736435203 -1.7194017519301119101 1.6300618854286375026 -1.2205714040442166013;-0.57639978266737867951 -3.960665155863138942 0.33264611179430203514 -4.1150643696098079261 7.4798358731931369192 -0.47883708085893478268];

% Layer 2
b2 = [-0.24992335581700692027;-2.916771199021885419;1.5233067050211066551;-1.9788851001801985863;2.8838486037821211561];
LW2_1 = [-2.3414445609794354297 -1.5945086120700719956 1.0035772654729151476 -0.12673750630302574316 0.10514662226270844736 -2.673249822846681667 -5.2970351015502741276 1.1445973597034866387 0.031925307093346205756 -1.6680829822196370227 -0.62638735441087589617 0.75734777718480994491 -4.5832471011287978513 1.4900821604604435056 0.64347066698816290931;1.2235635763500753992 5.8573983909811770943 0.059011241930159594182 0.92488550855629070302 -1.5368974256278995494 1.1557436618618919244 7.7482063753899055314 -1.5217195632168318831 0.32780649725268595773 -1.5583794480766413049 -0.029441707056506991047 0.62373422896726615772 5.2867443002789258344 -0.89610925054639800624 0.51176866379243257654;-3.151034112680214605 -6.2508026812679604589 0.021712034572590487025 -1.5332038729773638241 -1.4009856187910953995 -0.72280553522738333339 1.1488048003939301811 3.6306238786308626665 -0.26980189280155697507 -3.1262407632326882911 -0.63979656049764255243 -0.96321244619321910729 -0.37748828180890892092 1.4985701083309883597 -0.91677845052493200928;1.1034088684131915237 2.5569636492817653384 -1.8581918014412661666 0.11134280294714922477 -1.3824857922752478157 -0.42629250494299630869 -0.10861814117295404136 1.7083756244744621178 -0.035289242760314386282 0.95257952979581361763 1.1234183773227033321 2.2082898945821258785 -2.2597938922304829923 -2.6610264786929302971 -0.92258517985746157919;-1.0695701623966877847 -5.7095644010145862879 -0.048091503594699644419 -0.85202577696672832097 1.6186525372778792775 -1.2061240337983856197 -8.3104535155400398594 1.5136960096292286782 -0.32697313497723101694 1.7039640278925616279 0.084311397534011955912 -0.58092386296002018753 -5.6617318511344159049 0.8467350520819226789 -0.5538003980064927223];

% Layer 3
b3 = 0.051949925300255550553;
LW3_2 = [0.95697051485885997746 -11.242014952405607886 -0.32170513373992276618 0.53818247768051385993 -11.387789049195321311];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0686941773550495;
y1_step1.xoffset = -0.494993358850479;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
