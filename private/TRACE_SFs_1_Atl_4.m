function [Y,Xf,Af] = TRACE_SFs_1_Atl_4(X,~,~)
%TRACE_SFS_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:42.
% 
% [Y] = TRACE_SFs_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999025224415;-0.999999995392661;-40;0;22.805;-1.9603];
x1_step1.gain = [1.00000064853082;1.09776974554843;0.0153861540000154;0.000332778702163062;0.134898151895319;0.0611727426493303];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.79262485815055139238;-0.68478531773899919965;1.6499790672765035637;2.0920716598321402735;-3.3895990436577907445];
IW1_1 = [-0.52854793161020952041 0.026209595020471751492 0.015909714844335391681 -0.46890391812474685462 -0.93108389529794244321 -0.55886519786916655228;-0.78305117276780844549 0.12014517172840835646 2.9831928899847248715 -0.65295737381743990113 -1.2423048042228497234 0.34850091964421564539;0.0041461232386838702338 0.21261792121256828381 0.86004590663256563765 2.6316442069597112408 1.4097675078984455155 -0.55032343224523816438;-0.24599180272041268336 -0.49309048195805871284 -0.47661269650563481415 3.3194124032467224872 -0.29578177590296239607 -1.724429596103224327;1.2849538550818162541 0.21410776872988018793 3.2477075352083684123 -0.69220834104512196649 -0.38360897723005560334 -0.57376556751258334099];

% Layer 2
b2 = [2.5984381468706678753;2.3887377367250914872;2.8840332942985784648;1.1328446911051679447;1.1181890859070089395;-1.8023947819710732787;4.3253712263401364879;-2.1341530234691119539;6.0352111215390102927;-2.5017021368535661274;1.7459838713827140477;3.2159618587616005669;3.0885911460570003584;-0.82354050007073031914;5.7153042962207409872];
LW2_1 = [-1.1734250282856140135 2.6071155900667255523 -2.6207401134850991653 1.4660603675277166236 0.14721077009464586527;0.065641781819919572949 -4.0510051083994786936 -3.8709370088907477658 1.9602433872529700931 2.8097370547736386648;1.3126698359901360913 -2.5523331278370338104 1.9686782800837063778 -1.4876510435979191094 -2.659247492737104146;1.0858281299357495087 0.021116441700227445155 -0.035068489885042360144 1.5766307021147878409 -0.59376498172053748803;2.331064648539225459 -0.71318091836846975173 -0.28205018007673055003 1.7922099140899743208 -0.63233673429427439405;-1.6468579543063233128 0.48818736448804367356 -0.28622338684296411149 0.33058433169125917006 -2.003971738849764872;2.5735269715469879515 -1.3485728334478317425 -3.6669540906075419606 -6.9151759915675539148 -5.6397462126800679272;-1.7971029970903631412 0.48572585254403910504 -0.86218837439088447105 0.64152947232513224396 -3.1323257223096150348;-1.2990725621189764816 -6.5602166255777776271 -2.5917500627362959342 -4.677285674827673212 -3.2082115358277301098;-0.70807011462155999837 2.2825731218935421118 0.39666124783445710911 0.74656864204616402159 0.49774440654924151373;1.338440002808115592 -1.8870128446991139004 -0.70793909183575631783 -0.83655889812604822264 -0.17621488818326638826;1.9150722603011358647 1.7277907539896761868 -0.21215981052931873196 2.2563871884408222002 0.20051097072821882916;1.6421009992893429441 2.3436802799566223143 -0.079052143799228369314 -0.1511879406905282941 -0.43113078694820700099;-4.182686486867845943 0.87492475514987411156 1.075754834977686647 -1.6349260611405556087 0.80732945691775270802;0.85957409328441725105 -2.2802612000220374711 2.4038271160330011433 4.541714294313214495 1.7693569214261684053];

% Layer 3
b3 = 3.6900677056628738981;
LW3_2 = [-0.79369149561784357871 -0.42497875272870089258 -0.78628416521899446856 5.5946546854883454358 -6.7027380441748309892 -4.7129023865635533141 -0.21198216893323501564 2.0111315903745428102 -0.25066370105707519444 -2.8148777674460689902 -2.1692099304250898051 -1.2326632399883332702 -5.1559728041222694372 -2.4181928966329220287 -0.69427290780074368826];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.481947690293183;
y1_step1.xoffset = -2.9999223498254;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
