function [Y,Xf,Af] = TRACE_Preformed_O_1_Atl_3(X,~,~)
%TRACE_PREFORMED_O_1_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:38.
% 
% [Y] = TRACE_Preformed_O_1_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.0983162695220023419;-0.14172561253134019488;-46.200225186964132718;0.10695557261881492861;-4.1886954528794149155;-2.4029559127682196262;-0.46319332807124857787;-1.3230766135168545716;1.452717036954979335;3.9875104408753370144;1.6084004513154059879;-2.1457076418419274155;0.2474708192850124111;2.5537076205002713358;-8.7203193348825749354];
IW1_1 = [-3.6528293346267499686 2.8900574330074668694 -0.74426605672903822786 0.032899577105151234235 -3.6623122809721762039 4.1084516954301379954;-0.41887767565407324488 -0.15510368979597760619 -2.6907135996305320269 1.2142417960640450314 -2.5281069742280477541 0.38747469843823162394;-0.72934905435137475926 0.31652141536010519607 -0.38950020440878491135 -45.4729214647446085 -0.80228678568340039412 -0.64382875234677428011;0.14728096705757001694 -0.14848485613621489887 0.3982890960929570956 -0.10311678874970353625 -0.15536812904697144821 1.2447747419685957215;0.094533591874095379559 -0.015953370375403844866 -0.60474023594668868675 0.71748217303136541112 6.751995541874856066 -4.4235111107019564614;-0.10281515313825079216 0.53475345590044165434 3.5172689066760165488 -3.6842601104336125672 4.0836703482041905033 -1.9219007510379029213;-0.027860621579761234157 0.054939924646187646151 0.24829028164444955085 0.32381330839633198915 -0.5730197503582389329 1.6554330263582190952;-0.65142302803170004655 -0.064648854916594680753 1.8275003436689143399 0.79180166751317615503 -2.848382073331679365 -2.6005701234510301134;0.55591689425623158627 -0.85111104151821936892 2.1587834136202004309 3.7908254869824848932 2.1794417026333627874 -0.31875739250866502728;-0.1951335737211617738 0.94555639532655910706 0.74913984455190818501 1.788191835348171832 -1.5138061181434063762 0.1025343264989404396;0.46002287229345673047 -0.44975640664132843227 1.9738673159019910486 3.2215936833269811501 1.2844698430263694622 -0.23095911165218832584;-0.26999917270571222039 -0.026265321023485568852 -1.6793010946172353126 -1.9455097364526416914 -0.23983721229348170523 -0.39183023184770987557;-0.1150827165215323189 0.11718084516239678228 -0.3191796655887853551 0.072588010344513870242 0.13798736580492637627 -0.84856722294466890855;-0.10624053010399944763 0.90243760157919583609 3.4880236790058471996 0.92193326735869407518 3.2354169923393309993 -1.9164729602184804591;-0.85787149572672216635 -0.29065110827094636781 -3.3959073125189651599 -6.3353457692290362502 -5.7528911853078756877 -5.3587735999189529679];

% Layer 2
b2 = [10.915477003043790205;12.379284208104566645;-38.083952129128121555;-4.1307472573060302068;-0.47275149912743913427];
LW2_1 = [-0.79796433979644598722 0.28553129182802711172 12.98141239463086194 -2.464226386605627539 -2.6784869238984096995 2.0565648102801312724 3.4372342082785616313 -2.0723504332351758705 1.2177623372049313222 -2.7904916567146860196 -2.9342957225333861082 -4.2579301174400718821 5.5534656791690277799 -1.074097379572389821 0.29870135357818539124;-0.13868625428581213277 8.2686030006969239992 0.47866783162321485667 -2.322246091696489767 -0.72125074247045617426 -4.5687318081444567852 3.8799622359842387276 -0.16457598136085579976 -2.8399994077701111728 -4.1540945134694338137 3.0454540719083085243 -3.1224085225544646605 -1.7722039430394607162 6.2973328929495409056 -0.25803329559571269725;-5.3850844407355262788 -5.7726883631820600229 -21.707648731602841252 -5.4474258248645375247 0.9425823856562048908 7.5673602455567419156 -4.749122824248229513 -0.53209227409121417907 6.837810149273490623 8.3763221451343810031 -7.4949232623694452826 3.7245146546910348206 -10.077802082034052589 -8.8074010037022993913 0.49255580867006654167;0.085704829849209560044 -0.27914923226675941725 0.85802728842304454293 0.0042087196941869506328 1.9041416040990359893 -0.928803166602469088 -7.3867342287992823202 1.0635080249834867328 -1.411034050265385309 0.98068469548090397847 1.8595500882086006822 1.1730878031098772585 -3.5907784198909453721 -0.29161123544060535417 -0.67354319843864063344;-0.091288661438236509693 0.045349447366066227005 -0.54337072872644021082 3.6086884148452407217 -0.67832861722462556298 0.3562416669441236805 2.5519253903691958563 -0.41084202159457755554 0.66177749752825909546 -0.54880001223054153403 -1.044896212733545493 -0.82473352460297300048 7.0326162379501644395 -0.049100009801455929415 0.18563412697123451989];

% Layer 3
b3 = -4.0834309564667865544;
LW3_2 = [0.09877487105857692129 -1.0841520690982504593 -5.1690084703918657283 -0.42683962500564853748 -1.1328568859147807313];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00639021416728488;
y1_step1.xoffset = 136.002920238134;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
