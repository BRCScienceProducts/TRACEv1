function [Y,Xf,Af] = TRACE_Preformed_TA_1_Atl_4(X,~,~)
%TRACE_PREFORMED_TA_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:40.
% 
% [Y] = TRACE_Preformed_TA_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.1081318435446760873;-0.34072371519920963134;1.9044088382808783688;2.8942723120235873679;1.5647362174841865645];
IW1_1 = [-0.16552287400543552742 0.0022074366154047828092 -0.19553724310868814129 0.13685401531566060429 -1.8603288067188508137 0.15130576910852602812;-0.11342902232359318437 -0.3755908032596151358 -0.26479457818808727065 0.38611571451034348845 1.2864627814349902657 -0.15919535484889460464;0.038176263903365294239 0.41198579564160459077 0.22216676752788375171 -0.26581561455855023945 -0.12185666811926307296 1.4559438431326539032;0.66896924690006021041 0.3415789806217696678 1.0476729444664287794 3.4902139741698294806 -0.22012508167970001871 0.013766953821042818978;-0.40486070035038707049 0.017620640951349478276 -0.65804770232524567586 0.5039881763784032076 0.35658222649275633787 0.67466731657483147711];

% Layer 2
b2 = [-4.3870630712552207697;9.6370322790111941913;0.84544800468430691964;1.6027143617446060198;-0.056260083925735802912;1.7435328512155539027;-5.2473141285589139926;-1.6030591162466507615;11.796033903571631285;5.7646982818384522318;-2.8718448534312814857;12.40704748550190395;-8.9965740032432677253;-6.779846978909222166;-2.2535699614451880635];
LW2_1 = [-6.8355382780772595552 -9.167199014736590712 -2.1925627056309888729 -1.49282227639012266 4.7917625589617651727;1.1539841488059470187 0.38953078611281494181 0.39606165883094651692 -1.2922482045719123622 -10.331192500471287232;-5.7609433332182051757 -6.3940771681249737313 -7.6595937034163874557 -1.1078377964341987738 12.341606251002097849;0.24161178924946646873 -0.58434632341781456155 -0.55615001031343380689 -0.43079023775788322093 -0.28505531050112864477;-0.4065088085512915117 0.45070686749493593659 0.8994414459921844518 0.30738227664579925724 0.14419334109013887124;7.4727373110969157466 8.2132233726111874006 8.6047260734170194496 -0.64119000779945434232 -11.020192713433955234;0.69156942837193768892 3.211684912742958975 4.7722657670459076584 1.5660953814797755612 0.12713433499448065223;6.1305025712790204295 -4.5944768575293730706 -3.888102784063706796 -6.5275716952270723681 -7.9558259998074500885;0.64558434418204202476 2.6198778995190337149 -1.9578477440327222148 3.5362014206417802242 -7.4055424745231990258;-7.7850514872857701221 2.96539281547059419 4.5811572155047466381 -1.2764882213155321899 -0.81594273164098329865;1.969257665876827712 0.67617684043779446856 2.8655419106693185149 0.47332736837829719745 -0.79271707814296199501;-0.41839006567038200535 2.3496943435664836564 -11.754483347077332667 4.8333719476180290187 5.9530688411287666639;-1.3680956278045923735 -0.27170595446532852524 -0.32518793076191887526 1.2161662502061565405 9.6914500291037608548;-8.3666500744213827545 -9.6448574615293853896 4.3435787297667731721 -4.4475134786738541592 -1.4711160480234608539;-2.9415549500199791311 2.7339226818337580838 -7.1529175609143127446 -7.7459613086120535641 0.26976732444635420638];

% Layer 3
b3 = -0.61952541315125841948;
LW3_2 = [-0.92209165789929126156 1.1334317994959153264 -0.0074823724587213301732 1.8482540701613736633 0.92648330374037057844 -0.32289997813830007001 0.20899768759910566929 0.021167120958190482893 -0.069064517676084638542 -0.080335221619849433994 -0.22988384465167754911 0.33886966509807575632 1.3371026520013562511 0.93554303811647410161 0.78373128941910419343];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00331170470525242;
y1_step1.xoffset = 2032.08581542969;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
