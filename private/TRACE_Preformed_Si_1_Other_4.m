function [Y,Xf,Af] = TRACE_Preformed_Si_1_Other_4(X,~,~)
%TRACE_PREFORMED_SI_1_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:39.
% 
% [Y] = TRACE_Preformed_Si_1_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-77.5;0;30.1649227142334;-2.9811577796936];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0119760479041916;0.000363636363636364;0.22152510192902;0.0532708976942295];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.21377342182724742847;0.0059401594319978753833;-0.84863886734892590713;-3.907442232323224296;-4.1088270734815655061];
IW1_1 = [-0.69560249160620146736 -0.075346706612666292102 -0.081173001134740740969 0.25552902778858688215 0.16905080122230850548 1.2308706428097659913;-0.67619149813233947466 -0.45118174966770707712 -1.4745655657368628155 -1.0715247804424241629 -4.012065938019856226 3.6082075876744390541;-0.017565173673090992562 -0.14816630620691836895 -1.4427448049413906794 -1.1154768443465448158 1.0147645665526576764 0.21895046890178804233;-0.17748122464495652562 -0.1233550243426516646 -1.6128292301003686049 -0.75225770568577443598 -0.037671243090474877679 -2.3946890897235832973;-0.10821772307741107932 -0.013465504140655483456 -0.42723807955301001948 0.2489180692650650728 4.4601863844676143955 -4.8170786603356656741];

% Layer 2
b2 = [-4.059846084020083623;1.165646468630444188;22.293414880546912116;-3.7983143477191871895;1.6953226349899430669;2.961132282834813445;15.55326060930501697;-4.0264571842341299046;1.2372773742141338627;0.72016473848419948478;3.4196848287478935902;-1.210413494112236199;-1.2008658642325382715;0.96120809093565284797;1.1940011338823015574];
LW2_1 = [-0.88354859891454218257 -0.71495201947335218495 -0.74012680449412227013 -0.64425458643128896696 -1.1247941143199109426;-0.084799583478593468233 -0.70302440112720332444 -0.1728775730001062827 -0.79426757265541259034 0.91484887817117266362;0.71260348193511036108 -1.2728144523524418386 2.7201610558035342891 19.22761585905407955 0.84210887488912233856;-0.91519643099927938668 -0.84238414470172007231 -0.79143756267739606702 -0.16694877178743255941 -1.3119895994173349507;2.0732152326813637622 1.2241263603231660184 -0.42808700000084809467 -1.1826373749060787866 -4.2407563927091471712;-2.7303525783510140812 3.3044669628212872681 -0.44603955341781814647 -0.70591457930124290598 -2.5723340353995789442;-0.64626530655372504963 -7.2036401860941001729 -11.273263885550807828 -1.8894397080731901717 -3.1454688887371267114;2.8286168803127629268 -5.9373027432426308536 -0.6204393664024648869 14.581382530026161248 -10.785895060981513183;0.57117505795164269511 -0.85499713002261201744 2.6835054235094002451 -1.9062528949474744078 1.2065046471905878089;-0.3324054518995789298 0.45618737604243669859 0.45353171324676366805 -0.34586010506737119297 2.4364545255132039614;-2.6426626044281760208 5.7896159527624710961 1.4961699998375239673 -14.594095344098239053 10.693533754235248878;0.82389975779699642366 -1.6381901337326243429 -0.19035309056770086111 4.3694607835785177485 -5.5666703587811552367;-12.2672657911936831 19.363115148506331309 7.8024184958497979636 -37.079372901176853361 13.870471033721845089;-0.36246653145943125152 0.87710052954923978241 0.070677160910561795393 -0.10610504575860291165 1.4495398350565849022;-0.13247221491002264537 -0.80735070865117519734 -0.23185483902433701164 -0.9695743263865606032 1.0087720165304878694];

% Layer 3
b3 = -2.4942925233092414494;
LW3_2 = [-15.052352093655178678 9.9386955469680184905 1.1904865966989166548 11.344230370142176056 -0.15394274034311666854 -0.13152399814144632995 -3.3665990540449581836 6.2614425748757591705 -1.2789986542516187384 -0.95160800767302589076 6.1622352344933188917 0.18017294372244671563 -0.114828681050241313 1.3753345897276889609 -7.556196608796635239];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0184350799221364;
y1_step1.xoffset = -0.488903820514679;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
