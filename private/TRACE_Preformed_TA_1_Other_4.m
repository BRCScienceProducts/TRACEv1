function [Y,Xf,Af] = TRACE_Preformed_TA_1_Other_4(X,~,~)
%TRACE_PREFORMED_TA_1_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:40.
% 
% [Y] = TRACE_Preformed_TA_1_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-77.5;0;30.1649227142334;-2.9811577796936];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0119760479041916;0.000363636363636364;0.22152510192902;0.0532708976942295];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.13981513504648304669;0.40547511437095468123;0.37259484171494183791;-0.67259343744875177418;0.56614615471321272366];
IW1_1 = [-0.2812276791280364785 0.08089749744053278957 -0.93913875299860027912 1.2292610582862666391 0.85925073291531450792 1.0047158557923758782;0.20046025469670852859 0.061179657338659466925 0.29732044434897408891 -0.30984736816684305127 -3.1464335218897478974 0.040574911725023372899;0.089524306614181786701 0.076143966488731271158 0.13240478611286776722 0.080993808484204801723 0.139808323806396545 0.53175492853070904786;-0.26781782646081331301 -0.13757590099784289261 -0.34703350317246045575 0.26831529136851201001 -0.58947575264540008622 -0.54218169497490065201;0.60632434171921611998 0.33715595416410609753 1.2771117393200233092 -0.36541230835102112007 2.5352854901494268347 0.051223016488504372057];

% Layer 2
b2 = [-4.2461748227078537354;-4.1179604958566775608;-1.2617040363059874863;1.7084239432729704244;-2.5491364394314541819;-1.874962862817211473;0.70298298864561548083;0.65450665137054075959;-1.5771185314270810274;0.47160358933231488754;-3.654538683754124051;-1.6940111434627267428;2.3626872571383201738;1.7556171565068290352;0.52720094385262339376];
LW2_1 = [2.6583837948080781821 -0.15781397976625929913 0.53908617594232044468 0.29035732523452190135 -0.12219496611303845568;2.8673819368708124422 0.99937043458922125705 -12.561378315845971088 -9.5006633041765322645 -2.2348037540905028031;-0.5103770310505054697 -2.1936074211822078617 -1.0628231900942795018 1.9208020996035646277 0.84266686822760616948;-0.32843208262497070038 -0.59295246864302719736 1.5447884012417332222 0.22777391418720183136 0.74986093115708229995;1.2219597811153335432 1.3319734216589145248 -4.5503711522452388039 -3.0014494958310184991 -1.4096217833857351831;-0.81705939541396399584 -1.1930369683598487374 0.64251490548269263314 -2.0066797298334528854 -0.1784881081478471021;-0.75620379697582784662 -4.8977883465127343143 4.8986355682725850613 -3.4356878847584111369 -1.1181929367800920172;-0.793986466719116879 -4.7615682524962430477 5.1766243661462310044 -3.2834685062975847991 -1.1421319539592715842;-0.39772405406781086157 -1.1276393052473128176 -0.17811293198947714123 1.6226477210866063761 -0.10955112160653350528;0.39283023739190220391 0.31433981838168811862 0.71582956325862856506 -1.9383709766102534822 -1.593252617895541734;-1.161412075659791876 1.2009422586614069139 -4.2359077544057281983 0.040119330832648722462 0.91939478102245486557;-0.22309860031208161857 -2.0362177757650385956 -2.7361764818328735416 1.382762393969520609 1.4351077026564313943;-0.83296714180785302872 -1.5205577741800757607 1.969386206767686609 1.2206485500064274685 1.0598939827744118247;-0.12628740490787271344 -1.5026145901291374507 -1.0720879296832264149 -1.2477180355742665263 0.68119468902699564783;0.20979904733422638508 0.22263460586792882534 1.2751580313449779602 -1.7138615880976217909 -1.5020892088467761027];

% Layer 3
b3 = -1.611602791509225252;
LW3_2 = [1.4669755359466474243 0.65885298232682099062 3.9431900731530835635 -3.2691715268013314954 -3.6465283087017250629 0.35775595573923707482 -1.301693293139782881 1.312480022992091655 -3.7732851382320977685 1.6569727994012513062 -0.69188651472285711552 -5.8750306523989186402 -5.1581803847328089319 2.7563458242366909445 -2.3282578346266991076];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00351113753226865;
y1_step1.xoffset = 2059.216796875;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
