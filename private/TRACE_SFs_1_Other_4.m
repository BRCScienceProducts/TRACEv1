function [Y,Xf,Af] = TRACE_SFs_1_Other_4(X,~,~)
%TRACE_SFS_1_OTHER_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:42.
% 
% [Y] = TRACE_SFs_1_Other_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999999451688695;-0.999617390652097;-75.291;0;31.351;-1.9283];
x1_step1.gain = [1.00007734910688;1.00019210311383;0.014121999957634;0.0003147128245476;0.364192585038969;0.0607044754374516];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.0951686661450423799;-0.089790159309949990618;-1.2514603096324923293;-1.0011237413694085152;-0.86336404243845288331];
IW1_1 = [0.49354063693179311967 -0.33568818611677669894 0.79411504343541883255 0.22847693225561963026 -1.3157980780549873856 -0.80085285888245394403;0.023858830683642667791 -0.031275070665101989409 0.058261110742785948702 -0.69979474946781261568 -1.6717998165594907256 1.0691885763478421456;-0.57910509434624535263 -0.083685659373043258524 1.1400548992739010234 -0.093523225957648004059 1.6616997011967211684 -0.94951801367180754809;-0.24675620058477579222 -0.44852693995232328916 -0.67451690637628403113 0.07035351119139965359 -0.20911580543573804469 -1.465708574122771557;-0.11480981333848341852 -0.68140187581629529934 1.0794944267148260941 -0.16744175022904458916 2.0575088520178517193 -1.1421757260839990877];

% Layer 2
b2 = [-0.91021318310031884558;-0.22534701234510326473;1.9861145962654849217;-2.620610687825361218;8.3157607208843078439;1.0269695333931341263;2.4682269913958645446;-2.408798054289189583;-1.9925373853455590201;-0.54734498838292366951;-0.92061275221407179448;-4.1703631601108615001;-2.2732777259885610377;8.2984791892049560857;1.5034066089266595601];
LW2_1 = [1.0596071503442803241 2.0121323310482033264 -1.0671071516144667868 1.4360661052882179867 -0.94721694715217352734;-0.47281943352332589381 1.580689338967886437 -0.87551217007579351659 1.6008279020708695572 1.0131402282016579441;3.5730751624684100598 2.5154346768250506194 3.1264683326412452402 1.8101615423129360227 0.22991104677681103996;3.8252547812589496878 2.9901965037093836131 4.3899734662897724746 3.3459907432014266426 -0.97351312455520278011;-8.6202331264351936824 2.9585072826199492191 -1.5805517286253876197 -0.80083806589174522106 2.3852068817713218962;-1.8547911725259547122 0.73647597133836106842 -1.5844296177857413177 0.22021459364070009035 0.6308881379266989553;-3.0708297944327149764 -0.82907455736844770655 0.2507808949854015701 -2.2857280190083724136 -1.7744857574616590412;-0.95629096535016666625 1.8167607791222535329 1.4267643699838543636 -2.6390384918427582939 -0.43221851234738589698;4.125878558244688854 -0.47312294871282850606 1.0276084611539770819 0.90224847294399423969 0.28215426557665279628;1.5180912314081311809 4.4007959578352275898 -0.597912992294101997 -0.64375294543296412986 -0.81835585929265852734;1.9650804295513213393 -0.81403609755167960493 1.9686975687966445925 -0.51160695240737374956 -1.3168679021352827085;-2.0213212264871724955 0.96182271974826150096 -3.5365253004100822842 -4.112364268787467303 1.7643489384496444661;2.0537854202274705706 1.4572157376147754082 0.32241861110368086329 1.8278071218697637956 -0.57230258678467482714;-2.0021539360617306436 -0.19588543412646355901 4.9840059214316703162 -0.73587010480062819973 -2.6693051007963450871;0.80637597328934629282 -0.86986746748542531638 -1.1366146155325214107 1.2234053366029395971 0.66081403717235398521];

% Layer 3
b3 = -0.64325357804936500461;
LW3_2 = [-0.32929639956552980706 1.2006332357483575635 0.41210525980396572887 -0.13747060646725031696 -0.22316924403926632903 2.1045764986735631119 -0.2548507512376466666 -1.8460422452921647629 0.61550783339732850763 -0.26006763634775320604 2.0411968792988113286 0.36295487958918681848 -1.2223795085480300138 1.9780659304093843875 -3.7242694324401415251];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.479723223512926;
y1_step1.xoffset = -2.9999223498254;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
