function [Y,Xf,Af] = TRACE_Preformed_Si_1_Atl_2(X,~,~)
%TRACE_PREFORMED_SI_1_ATL_2 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:39.
% 
% [Y] = TRACE_Preformed_Si_1_Atl_2(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.0655828530634776641;0.80484432551273166201;-1.8443481744356657881;0.49549879488454423582;-0.03897224729369765106;3.2416782657095568609;0.70093109073165971168;-1.7373611459382329869;-0.43153040285228583262;23.798890187794786044];
IW1_1 = [1.4991370148209695046 -0.76670754139975461072 -2.1207087020305284142 6.4691716804688388365 -11.246517363173998305 5.0436483645663434672;0.17568300383239418561 -0.070032230854316326885 1.9991185714761847692 -1.8651486260399730011 -0.97485893297586567741 0.17490717083903495332;-0.69628688894074475257 0.49907560247888138605 0.85370151574019803586 -0.24395659591469170957 -16.309653325040738281 -2.6264479884487332839;-0.24264085174591581984 0.13886440993430063107 -0.83476654293813279395 -0.12982176756041174936 -0.26812457177377463369 -1.0135888271958914952;-0.10642738499949237763 0.020084173538806003589 -0.59720402507249703561 -1.2128653703415817056 -0.48541763070888660492 1.4386315464787635676;-6.7556861268949015553 6.9712290998316941426 -0.27684964542202838977 0.8755165388619620126 -0.27034096277619673598 -0.67423051236772746364;0.15716975991062015483 0.17673231302783087848 -1.6588656178539091801 -0.85486823757405583368 -2.3577246679706442833 1.772895088121770879;0.051243312213143731026 -0.067456926510258585772 -0.99591136490387666136 0.19456632768356579843 -3.3414654244218056078 -0.59857645302218176475;-0.28054900710709174128 0.99529465404147210439 4.0461003326708198102 0.31801888223703472791 -2.2199784291009088122 0.24175945296863196599;1.053539696175928464 -0.17740814146995004252 1.371032044054119492 25.270999555048007323 -0.1375311913281918319 0.25261447732422215307];

% Layer 2
b2 = [7.9796796502751181634;-3.3967555058527763023;-2.8691339672483842094;-1.155966813961459394;-3.1370225220800098676;-2.5547867123305665338;2.2785113218754480258;2.9990996469317687811;-10.292504504381474462;-6.7573522578872191602];
LW2_1 = [20.779953601788790252 10.770633298309794768 0.34297017843268157167 -1.2004414627023736184 -1.9508559397528544288 -0.21276760214058174081 3.9619665180956755712 -1.626822246905267999 2.2147348581674619616 0.64867727501536198709;-0.41073824771267053446 -1.0025752713232169988 -0.66284302834437869301 0.88350837197544718205 -0.55240467740353238479 -0.14361380050915800721 0.5442540821848930177 -3.583503562271926679 -0.30056962346481697068 0.82389675402042017449;1.5427496037025205666 0.37386550515150179796 -0.21632563182367758881 0.023118510226346269953 -1.6094100815463072696 0.066725626548139210792 1.0020577074453778099 -3.0816482525578874352 0.73420127290198167191 -0.31764346025705614274;0.4251412024233025555 2.6614301926064203307 0.074389238009289926357 2.0603930759885780155 -0.61622734189286787476 -0.42254718881358449556 0.6672025691194951591 2.8381260207767300408 1.6689231283877863365 -0.42435171688505018972;-0.96832957079964387948 1.4652536280505454869 -0.25315927428783718822 0.24450940043779023636 -2.0248675516764103044 -0.24486454854001443726 1.8519509821595097065 -0.21795507146609413573 -0.2795573671919908687 -0.13301284138126975853;1.5362047352648231513 0.41556915499457741658 -0.1550633708084360185 -0.29172562928090528533 -1.7902052502022278713 0.1020554928229491648 0.92343023283107339427 -3.1671790187379857962 0.6607213662112927377 -0.46560645521938526237;0.50383068014839127446 -1.3433489827675606509 0.14163906798879596916 -0.14175613016927590682 1.7661738842193408505 0.25995631347446418458 -1.694742636031092653 0.17493444074908071073 0.27986072931022071275 0.18994678422193267409;0.34533879174564341419 0.82762059723082337381 0.6122825505937390389 -0.8271601362050784445 0.20256040421442148003 0.083151859658315840917 -0.28267843121815483531 3.129752087079397338 0.28735297310487156741 -0.73512892769946280858;-0.85770858911739966679 -2.5277115081649292883 -1.561431841996536507 8.7060873191608489918 -1.4516381329201655248 27.250458964243605919 -2.2689023830461079179 1.4590194783744221407 -24.389022959158012327 -1.7508204967565943466;5.5202456869912381876 5.1576095377236530481 -0.82172840775584909956 1.0871498434947803879 -7.4031638974443909618 0.2328491274091517016 -0.047649756351572113144 1.3422611555679870854 1.3995498367597525302 -2.5276800428667569598];

% Layer 3
b3 = 1.4498282809774976077;
LW3_2 = [-0.1832198845413978705 3.2417783268016377995 4.9338521525197718276 -0.33134883276764975912 1.6304040411111446751 -3.5677871656142432499 1.7801644863924090956 3.9606850592832323343 9.5235324279989832519 -8.9316128018074323336];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.0510398195720568;
y1_step1.xoffset = -0.473623931407928;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
