function [Y,Xf,Af] = TRACE_Preformed_O_1_Atl_4(X,~,~)
%TRACE_PREFORMED_O_1_ATL_4 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:38.
% 
% [Y] = TRACE_Preformed_O_1_Atl_4(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.92610913549122508837;-0.391165167904864719;-0.11865463584534194363;-1.9073309392837891618;0.45397618936178119053];
IW1_1 = [0.011110385049221854423 -0.013343912902048239363 0.49335815701620250318 -0.81465627840446275254 0.7413440621722838797 0.44972077770160340249;-0.0035695454126025726906 -0.0013633551888693890008 0.92309064319570910406 -0.10541439699491990389 0.37252536883931952616 -0.17792027784853478578;0.0094832774857499836652 -0.0080206411965955317495 -0.76768927140736487047 -0.54778248608450930135 -0.25961193386002656691 0.25708170040482408725;-0.0044981236184550472956 -0.0034824257060641419792 1.9111190208335180341 -0.17734015312391115948 0.49559372378299715312 -0.33704200714129034511;0.021659154564312662478 -0.0054625442518159272182 0.45048979808608369257 0.51598967061378331334 0.68463482723912683081 0.40964004127062397798];

% Layer 2
b2 = [1.2045762733369469455;-2.1949410225889347537;-1.6109604968951445336;-6.7741021703108659224;-6.3761854937068322968;-1.1475516606176494605;2.631129974955258799;-5.9098671403007330127;-0.91347511941937842295;-1.1110519950805211042;-1.3225822819908357175;-2.3113343070543579394;1.0754082686336674524;2.0204694990149696388;26.168560872893323221];
LW2_1 = [0.060547540016295670062 -4.9395424317911116319 1.126720645724598624 5.1477247553085865306 5.6941011701962267466;-1.7313973898630361514 7.5957852618610175455 7.9213217984540333916 -0.52899629852314267175 1.9208191201785489444;3.8095646291646545478 1.2545371364990329788 0.72707972516909658012 -0.30690063883854812321 -4.2555073325700769615;-10.941675636747683953 32.832983513297016032 31.578741047388934504 1.3227375895981723364 4.3977217165430548818;2.2817315221752045851 6.2704605951853764623 -10.816591417501280503 -6.9591599872087073209 -8.5778157305040974023;2.2362395016587113261 -0.5433353685094801655 0.74814647286546331895 -0.97554583965097374509 -2.537615882141921464;-3.8979245325760349949 -2.0979086811565408333 -2.2966657067945663862 0.99026521496337660544 4.2418497813601430124;-39.693145456577681784 31.9044234519138179 38.643515093267794214 4.5900261367262746859 37.107442116129178089;3.7428008377530788131 -2.8631321822673974076 -4.8298080996510659446 -2.7463871444476786188 -3.7679690396061786828;3.3674919428104566066 -1.8195973134607819066 -0.43987189993736891536 -1.2538506792860606431 -3.4005476445511182426;-6.5496521949662689366 5.3040188404111923148 3.8196956862102289243 -0.2626258510197899132 5.9708988260460236219;-15.744773948768331806 2.545613177209681055 -8.2743108345132192483 -9.8262960773497880496 14.259581347159047127;-3.6480151227697779071 2.7857529002812073671 4.8755491639003958326 2.894121057161000099 3.8795144398364991289;-15.316654830373886753 -1.4740653728203068074 -15.190569601987663262 -8.0584882004400988365 13.525811316030642573;28.7658548428001275 -14.10093343942137345 4.4941608275488400537 9.838178173820812944 11.563918221313830514];

% Layer 3
b3 = 9.354669774557901718;
LW3_2 = [0.13380519892450365438 1.7970886499760014843 39.00407070902124218 -0.55539604744465176367 0.18648513686677548051 -11.860485369671188494 31.093578392449238379 0.26563286949426140326 -9.7810921824509193812 16.500936223821177862 4.8871529678436642641 -2.660336411240511012 -9.7627441553131575347 2.0993243816705278171 0.013781729679497754446];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00639021416728488;
y1_step1.xoffset = 136.002920238134;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
