function [Y,Xf,Af] = TRACE_Preformed_TA_1_Atl_3(X,~,~)
%TRACE_PREFORMED_TA_1_ATL_3 neural network simulation function.
%
% Auto-generated by MATLAB, 21-Aug-2024 10:13:40.
% 
% [Y] = TRACE_Preformed_TA_1_Atl_3(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 6xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.999961923064171;-0.999961923064171;-39.5;0;30.0316562652588;-2.96613502502441];
x1_step1.gain = [1.00003807838574;1.00003807838574;0.0155038759689922;0.000363636363636364;0.207805673664695;0.0607333297500273];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.82454073273428363233;-2.4311048181402443724;-1.7111336710690348006;-1.1721992450452591861;1.4321168669419561681;-1.6234511006835570246;1.6810310694339567483;1.2162423642279185376;0.75925493835253421437;-0.77661357913152717636;-1.8252942125443871735;0.77913200413437166958;19.527172649566352902;-3.3359645774744186575;1.364363669481446939];
IW1_1 = [-2.2719007662661998559 0.56023175594654883724 -2.3807130900237947202 1.6317410064874073861 -0.17984335684505090014 1.5236021608062113586;-1.6638112471347545895 1.284346990707531555 -0.91099793892963176756 -2.662694086646962166 2.2351525721864078378 0.98294131219057467863;1.2314078781789747907 -0.43035270982747253488 -0.16524404716959315009 0.99686793425450093142 -3.3249228535315680233 -1.4682106491260902281;1.4659384641291068885 0.51661944439080664804 0.61158535869021823927 1.4891518067588900287 -1.2515329160865702463 -0.61209327049000405996;-2.1635481518551049618 -0.57906866292709557875 3.8531631534814665407 0.39487142209072467747 -3.0300061068133454789 1.1321349718975017851;0.91197219215300040496 -1.0460171170678582708 0.25360308122360702976 -1.6453153129445068359 -1.185893758297469347 1.7997828572169056738;-2.230016009253442455 0.016279074692296564841 -2.3026082683884716573 1.5618434617353016414 -1.8889371348160279851 -0.18073403487431125014;-0.92267944248141275931 -0.36550805746423481457 -1.5544318689901626129 -0.35352346892822711366 -4.5278919359996594451 1.3525771663731862571;-0.85687955292309481159 -0.84469364236519184352 -0.22596969731030569495 0.72926462077180420618 -1.3192750404841369072 -0.042346108283428579577;0.46346314370776992009 -0.044828145425213940245 -0.37137661840806462932 -0.93313279550764394177 -0.881492434277548087 0.16561909595878496204;0.043718524445769103848 -0.60843540131164763896 -0.12159731125259934381 -1.8550877972678943006 2.1641814686091187525 0.18352078042462210972;-0.22272799178352442606 0.040217022687584397245 -0.0834419964093116584 -0.082544725151045481026 -0.63628647737292143294 0.13796296419860831772;0.63966178539400442293 0.059384934534888841884 -13.61803837555534713 5.274857564110780217 -1.2825395837017212752 -0.23859638495156457183;0.71843303412866987845 -1.5406943838874702646 -0.30498946336861842976 -0.88005645859301029343 1.5355456824831166251 -2.2721308975687692921;-1.3455979413030971781 -0.47798456913074943708 -0.60715440375815210583 -1.4694833828910098816 0.92275076844932890641 0.76483412269164585684];

% Layer 2
b2 = [4.4436514250609366883;2.8802808982937406768;-0.49439898039399787777;2.1265879063128885207;-0.35692790185811917869];
LW2_1 = [1.0028622347671709569 -0.75718755903168033505 -0.97046734770184128749 -1.5694110524641462501 -0.25677324299523385243 1.7116745417752945446 0.37925976531385913182 0.49176430403480236864 -1.7864157952383541428 -3.4700676847362270649 -1.7374642241164790502 1.5099112971434573982 -0.81645890538896981337 1.549932677860007546 -5.0931663447235253628;0.87962493490027993115 -0.65382059301629391612 -0.51655228293801302986 0.58035281940672067691 -0.23895998928089132174 1.5074189980144483414 0.45802541624063436432 0.36191168679596547042 -1.7020314843634747337 -3.3410670775091468876 -1.2638226776387122552 1.6460755238875111051 -0.54492650711178114431 1.3640062258223559777 -1.3936764684631404165;-0.4329373438880235736 0.40880340893390648693 -0.17711135466390229287 1.6550381806949336916 0.19813406720036197406 -0.78177689198291944184 -0.41339956728857280011 -0.14275265114853971649 1.2121237825848141245 2.2557035008420056599 0.51335480412472245249 -3.3001458270632713088 -0.67225605735142623942 -0.82283406171547790464 2.982815775984056561;0.40727292528765945967 -0.51274591785866030502 0.093082699442370173126 0.7295477731062092186 0.23142303889368126546 -0.10733719912259680196 -0.93420256019370451206 -0.56027187801162448011 0.62307589358222625897 1.4118103705455082864 0.17711991034417551294 1.6483698496164334024 -5.5668289254619267581 -0.61569965733503950744 1.2944775560119468061;1.7233789315676650844 -0.097360641697365885028 0.79602028659171641944 2.8857879184283188323 -0.90496489166047844321 -2.4216113665290719403 -1.6412096107727320859 -1.2905156416738268188 0.555812890991728481 -0.25292569527416947084 2.5822068649480667268 5.6181887212641417051 -4.7243174489855537246 -0.90300165132786813782 3.1159076498503663899];

% Layer 3
b3 = 0.29629925743884838463;
LW3_2 = [-0.97187119620390038932 1.5687695393022123014 1.1359056969806358151 -0.31118637223952944071 0.17747850857378347222];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.00331170470525242;
y1_step1.xoffset = 2032.08581542969;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
